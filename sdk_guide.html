<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <style type="text/css">
  @page {
      @bottom {
          content: counter(page) "/" counter(pages)
      }
  }
  
  @page { margin: 30pt 20pt 30pt 20pt }
  
  body {
     font-family: Helvetica, arial, freesans, clean, sans-serif;
     font-size: 14px;
     line-height: 1.6;
     padding-top: 10px;
     padding-bottom: 10px;
     background-color: white;
     padding: 30px; }
  
  body > *:first-child {
     margin-top: 0 !important; }
  body > *:last-child {
     margin-bottom: 0 !important; }
  
  a {
     color: #4183C4; }
  a.absent {
     color: #cc0000; }
  a.anchor {
     display: block;
     padding-left: 30px;
     margin-left: -30px;
     cursor: pointer;
     position: absolute;
     top: 0;
     left: 0;
     bottom: 0; }
  
  h1, h2, h3, h4, h5, h6 {
     margin: 20px 0 10px;
     padding: 0;
     font-weight: bold;
     -webkit-font-smoothing: antialiased;
     cursor: text;
     position: relative; }
  
  h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
     text-decoration: none; }
  
  h1 tt, h1 code {
     font-size: inherit; }
  
  h2 tt, h2 code {
     font-size: inherit; }
  
  h3 tt, h3 code {
     font-size: inherit; }
  
  h4 tt, h4 code {
     font-size: inherit; }
  
  h5 tt, h5 code {
     font-size: inherit; }
  
  h6 tt, h6 code {
     font-size: inherit; }
  
  h1 {
     font-size: 28px;
     color: black; }
  
  h2 {
     font-size: 24px;
     border-bottom: 1px solid #cccccc;
     color: black; }
  
  h3 {
     font-size: 18px; }
  
  h4 {
     font-size: 16px; }
  
  h5 {
     font-size: 14px; }
  
  h6 {
     color: #777777;
     font-size: 14px; }
  
  p, blockquote, ul, ol, dl, li, table, pre {
     margin: 15px 0; }
  
  hr {
     border: 0 none;
     color: #cccccc;
     height: 4px;
     padding: 0;
  }
  
  body > h2:first-child {
     margin-top: 0;
     padding-top: 0; }
  body > h1:first-child {
     margin-top: 0;
     padding-top: 0; }
  body > h1:first-child + h2 {
     margin-top: 0;
     padding-top: 0; }
  body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
     margin-top: 0;
     padding-top: 0; }
  
  a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
     margin-top: 0;
     padding-top: 0; }
  
  h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
     margin-top: 0; }
  
  li p.first {
     display: inline-block; }
  li {
     margin: 0; }
  ul, ol {
     padding-left: 30px; }
  
  ul :first-child, ol :first-child {
     margin-top: 0; }
  
  dl {
     padding: 0; }
  dl dt {
     font-size: 14px;
     font-weight: bold;
     font-style: italic;
     padding: 0;
     margin: 15px 0 5px; }
  dl dt:first-child {
     padding: 0; }
  dl dt > :first-child {
     margin-top: 0; }
  dl dt > :last-child {
     margin-bottom: 0; }
  dl dd {
     margin: 0 0 15px;
     padding: 0 15px; }
  dl dd > :first-child {
     margin-top: 0; }
  dl dd > :last-child {
     margin-bottom: 0; }
  
  blockquote {
     border-left: 4px solid #dddddd;
     padding: 0 15px;
     color: #777777; }
  blockquote > :first-child {
     margin-top: 0; }
  blockquote > :last-child {
     margin-bottom: 0; }
  
  /*
  table {
     padding: 0;border-collapse: collapse; }
  table tr {
     border-top: 1px solid #cccccc;
     background-color: white;
     margin: 0;
     padding: 0; }
  table tr:nth-child(2n) {
     background-color: #f8f8f8;
     }
  table tr th {
     font-weight: bold;
     border: 1px solid #cccccc;
     margin: 0;
     padding: 6px 13px; }
  table tr td {
     border: 1px solid #cccccc;
     margin: 0;
     padding: 6px 13px; }
  table tr th :first-child, table tr td :first-child {
     margin-top: 0; }
  table tr th :last-child, table tr td :last-child {
     margin-bottom: 0; }
  
  */
  
  /* table */
  
  table {
      /*width: 100%;*/
  	border-top: 1px solid #919699;
  	border-left: 1px solid #919699;
  	border-spacing: 0;
  }
  	
  table th {
  	padding: 4px 8px 4px 8px;
  	background: #E2E2E2;
  	font-size: 12px;
  	border-bottom: 1px solid #919699;
  	border-right: 1px solid #919699;
  }
  table th p {
  	font-weight: bold;
  	margin-bottom: 0px; 
  }
  	
  table td {
  	padding: 8px;
  	font-size: 12px;
  	vertical-align: top;
  	border-bottom: 1px solid #919699;
  	border-right: 1px solid #919699;
  }
  table td p {
  	margin-bottom: 0px; 
  }
  table td p + p  {
  	margin-top: 5px; 
  }
  table td p + p + p {
  	margin-top: 5px; 
  }
  
  
  
  img {
     max-width: 100%; }
  
  span.frame {
     display: block;
     overflow: hidden; }
  span.frame > span {
     border: 1px solid #dddddd;
     display: block;
     float: left;
     overflow: hidden;
     margin: 13px 0 0;
     padding: 7px;
     width: auto; }
  span.frame span img {
     display: block;
     float: left; }
  span.frame span span {
     clear: both;
     color: #333333;
     display: block;
     padding: 5px 0 0; }
  span.align-center {
     display: block;
     overflow: hidden;
     clear: both; }
  span.align-center > span {
     display: block;
     overflow: hidden;
     margin: 13px auto 0;
     text-align: center; }
  span.align-center span img {
     margin: 0 auto;
     text-align: center; }
  span.align-right {
     display: block;
     overflow: hidden;
     clear: both; }
  span.align-right > span {
     display: block;
     overflow: hidden;
     margin: 13px 0 0;
     text-align: right; }
  span.align-right span img {
     margin: 0;
     text-align: right; }
  span.float-left {
     display: block;
     margin-right: 13px;
     overflow: hidden;
     float: left; }
  span.float-left span {
     margin: 13px 0 0; }
  span.float-right {
     display: block;
     margin-left: 13px;
     overflow: hidden;
     float: right; }
  span.float-right > span {
     display: block;
     overflow: hidden;
     margin: 13px auto 0;
     text-align: right; }
  
  code, tt {
     margin: 0 2px;
     padding: 0 5px;
     white-space: nowrap;
     border: 1px solid #eaeaea;
     background-color: #f8f8f8;
     border-radius: 3px; }
  
  pre code {
     margin: 0;
     padding: 0;
     white-space: pre;
     border: none;
     background: transparent;
  }
  
  .highlight pre {
     background-color: #f8f8f8;
     border: 1px solid #cccccc;
     font-size: 13px;
     line-height: 19px;
     overflow: auto;
     padding: 6px 10px;
     border-radius: 3px; }
  
  pre {
     background-color: #f8f8f8;
     border: 1px solid #cccccc;
     font-size: 13px;
     line-height: 19px;
     overflow: auto;
     padding: 6px 10px;
     border-radius: 3px; }
  pre code, pre tt {
     font-family: Consolas, "Liberation Mono", Courier, monospace;
     background-color: transparent;
     border: none; }
  
  sup {
     font-size: 0.83em;
     vertical-align: super;
     line-height: 0;
  }
  * {
  	 -webkit-print-color-adjust: exact;
  }
  @media screen and (min-width: 914px) {
     body {
        width: 854px;
        margin:0 auto;
     }
  }
  @media print {
  	 table, pre {
  		  page-break-inside: avoid;
  	 }
  	 pre {
  		  word-wrap: break-word;
  	 }
  }
  </style>
</head>
<body>
<h1 id="cc视频-android-sdk-使用说明">CC视频 Android SDK 使用说明</h1>
<p>日期：2018-05-15</p>
<table>
<thead>
<tr class="header">
<th>版本号</th>
<th>更新日志</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>v2.14.0</td>
<td>1. 优化上传视频流程</td>
</tr>

<tr class="even">
<td></td>
<td>2. 问答功能支持在问题和答案中显示图片</td>
</tr>
</tbody>
</table>
<h2 id="概述">1. 概述</h2>
<p><br/></p>
<p><strong>CC视频Android SDK</strong>是基于Android API实现的类库，支持Android2.3及以上版本，开发者可通过此SDK对接CC视频云服务平台，进行播放、上传和下载操作。</p>
<p><br/></p>
<h2 id="如何使用sdk">2. 如何使用SDK</h2>
<p><br/></p>
<p>CC视频2.0版Android SDK包提供了以下文件：</p>
<ul>
<li>CCSDK.jar，是集成SDK播放、上传和下载等功能的类库；</li>
<li>sdk_guide，是SDK的使用指南；</li>
<li>ccsdkdemo，是使用SDK对接CC视频云服务的示例源码，支持Android4.0及以上版本；</li>
<li>sdk_doc，是描述SDK内部接口信息的文档。</li>
</ul>
<p>为确保SDK可正常使用，请按照以下操作配置项目环境：</p>
<h5 id="将ccsdk.jar添加到android项目中并配置当前项目可正确的引用此类库">1. 将CCSDK.jar添加到Android项目中，并配置当前项目可正确的引用此类库。</h5>
<h5 id="配置项目的网络权限和文件读写权限">2. 配置项目的网络权限和文件读写权限：</h5>
<div class="sourceCode"><pre class="sourceCode xml"><code class="sourceCode xml"><span class="co">&lt;!-- 用于网络通信 --&gt;</span>
<span class="kw">&lt;uses-permission</span><span class="ot"> android:name=</span><span class="st">&quot;android.permission.INTERNET&quot;</span> <span class="kw">/&gt;</span>
<span class="co">&lt;!-- 用于存储已下载文件 --&gt;</span>
<span class="kw">&lt;uses-permission</span><span class="ot"> android:name=</span><span class="st">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> <span class="kw">/&gt;</span></code></pre></div>
<h5 id="ccsdk.jar已经过混淆处理如果需要对应用进行混淆编译请在混淆的配置文件中加入以下代码以避免sdk被二次混淆编译">3. CCSDK.jar已经过混淆处理，如果需要对应用进行混淆编译，请在混淆的配置文件中加入以下代码，以避免SDK被二次混淆编译。</h5>
<pre class="typescript"><code>-dontwarn com.bokecc.sdk.mobile.**
-keep public class com.bokecc.sdk.mobile.**{*;}
-keep public interface com.bokecc.sdk.mobile.**{*;}</code></pre>
<h3 id="视频播放">2.1 视频播放</h3>
<p>SDK视频播放由DWMediaPlayer类实现，DWMediaPlayer继承了Android的媒体播放器MediaPlayer类，并重载其prepare()和prepareAsync()方法。</p>
<p>使用DWMediaPlayer既可播放CC视频云服务平台下的视频（以下简称在线播放），也可播放本地视频。</p>
<h4 id="在线播放">2.1.1 在线播放</h4>
<p>使用SDK的在线播放功能时，仅需设置视频ID、账户ID、API KEY及Context（上下文信息）即可播放云端视频。具体实现方式如下：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span> videoId =<span class="st">&quot;123456&quot;</span>; 
<span class="bu">Context</span> context = <span class="fu">getApplicationContext</span>();
DWMediaPlayer player = <span class="kw">new</span> <span class="fu">DWMediaPlayer</span>();
<span class="co">// 设置视频播放信息</span>
player.<span class="fu">setVideoPlayInfo</span>(videoId, <span class="st">&quot;USERID&quot;</span>, <span class="st">&quot;API_KEY&quot;</span>, context);
player.<span class="fu">prepareAsync</span>();</code></pre></div>
<p>当播放器准备播放完成后，调用start()方法开始播放视频。同时，DWMediaPlayer提供了getVideoStatusInfo（获取视频状态），getVideoTitle（获取视频标题）等方法，开发者可根据需要在应用中展示相应的信息。</p>
<h5 id="选择清晰度播放">选择清晰度播放</h5>
<p>DWMediaPlayer提供了getDefinitions()方法获取当前播放的视频清晰度列表。如果需要切换视频的清晰度，可根据当前视频的清晰度对DWMediaPlayer进行设置。具体实现方式如下，</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// 获取清晰度列表</span>
<span class="bu">Map</span>&lt;<span class="bu">String</span>, <span class="bu">Integer</span>&gt; definitions = player.<span class="fu">getDefinitions</span>();
<span class="co">// 获取某种清晰度对应的状态码</span>
<span class="dt">int</span> definitionCode = definitions.<span class="fu">get</span>(<span class="st">&quot;definitionInfo&quot;</span>);
<span class="co">// 设置播放清晰度</span>
player.<span class="fu">setDefinition</span>(context, definitionCode);</code></pre></div>
<h5 id="设置ondreamwinerrorlistener">设置OnDreamWinErrorListener</h5>
<p>DWMediaPlayer获取播放地址产生的异常需要通过OnDreamWinErrorListener来获取异常，需要用户自行设置该监听。</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">player.<span class="fu">setOnDreamWinErrorListener</span>(...)</code></pre></div>
<h4 id="本地播放">2.1.2 本地播放</h4>
<p>在使用DWMediaPlayer播放本地视频时，与使用Android默认媒体播放器MediaPlayer播放本地视频的方法相同，仅需设置视频文件地址。具体实现方式如下，</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">String</span> path = <span class="st">&quot;/123456.MP4&quot;</span>;
DWMediaPlayer player = <span class="kw">new</span> <span class="fu">DWMediaPlayer</span>();

<span class="co">//设置视频文件地址</span>
player.<span class="fu">setDataSource</span>(path);
player.<span class="fu">prepare</span>();</code></pre></div>
<p>当播放器准备完成后，调用start()方法即可开始播放视频。</p>
<h4 id="错误处理">2.1.3 错误处理</h4>
<p>DWMediaPlayer重载了MediaPlayer的setOnErrorListener()方法，如果需要在应用中提示错误信息，可调用此方法设置OnErrorListener。具体实现方式如下，</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> OnErrorListener onErrorListener = <span class="kw">new</span> <span class="fu">OnErrorListener</span>() {
  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">onError</span>(MediaPlayer mp, <span class="dt">int</span> what, <span class="dt">int</span> extra) {
    <span class="co">//TODO 处理错误信息</span>
    <span class="kw">return</span> <span class="kw">false</span>;
  }
};

player.<span class="fu">setOnErrorListener</span>(onErrorListener);</code></pre></div>
<h4 id="移动端广告">2.1.4 移动端广告</h4>
<ol style="list-style-type: decimal">
<li>本功能需要后台开通移动广告；</li>
<li>广告核心类<code>DWMediaAD</code>提供能了获取广告信息的方法，广告详细信息通过<code>DWMediaADListener</code>监听器回调来获取；</li>
<li>广告分为前贴和暂停，需要分别调用方法来获取。其中前贴目前提供了视频和图片广告，暂停只有图片广告。</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">……
DWMediaAD mDWMediaAD = <span class="kw">new</span> <span class="fu">DWMediaAD</span>(dwMediaADlistener, USERID, videoId);
mDWMediaAD.<span class="fu">getFrontAD</span>();
mDWMediaAD.<span class="fu">getPauseAD</span>();
……
<span class="co">// 广告监听器</span>
<span class="kw">private</span> DWMediaADListener dwMediaADlistener = <span class="kw">new</span> <span class="fu">DWMediaADListener</span>({
    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onPauseAD</span>(PauseADInfo info) { <span class="co">//回调暂停广告信息</span>
    ……
    }
    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onFrontAD</span>(FrontADInfo info) { <span class="co">//回调片头广告信息</span>
    ……
    }
    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onFrontADError</span>(DreamwinException e) {
        ……
    }
    <span class="at">@Override</span>
    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onPauseADError</span>(DreamwinException e) {
    }
};</code></pre></div>
<p>注：目前只提供获取广告信息的接口，广告界面需要用户自行实现，具体可参见普通版demo的<code>ADMediaPlayActivity.java</code>类文件。</p>
<h4 id="用户自定义参数播放统计功能">2.1.5 用户自定义参数播放统计功能</h4>
<p>支持用户自定义参数实现播放的统计，可以通过调用player的<em>setCustomId(String customId)</em>方法来实现，其中customId为用户自己定义的参数值。</p>
<p>注：需要在prepareAsync()方法前调用才可以生效。</p>
<h4 id="视频打点功能">2.1.6 视频打点功能</h4>
<p>支持用户自定义视频打点功能的回调，可以通过调用player的<em>setOnHotspotListener(OnHotspotListener onHotspotListener)</em>方法，当视频有打点信息时，在该接口中回调打点信息。</p>
<h4 id="视频问答功能">2.1.7 视频问答功能</h4>
<p>支持用户自定义视频问答功能的回调，可以通过调用<em>player的setOnQAMsgListener(OnQAMsgListener qaMsgListener)</em>方法，当视频有问答信息时，在该接口中回调问答信息。</p>
<p>问答信息回调的格式为JSONArray，单条问答信息的内容如下，请用户自行解析</p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="dv">99</span><span class="fu">,</span><span class="dt">&quot;content&quot;</span><span class="fu">:</span><span class="st">&quot;内容&quot;</span><span class="fu">,</span><span class="dt">&quot;showTime&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;explainInfo&quot;</span><span class="fu">:</span><span class="st">&quot;解释答案&quot;</span><span class="fu">,</span><span class="dt">&quot;jump&quot;</span><span class="fu">:</span><span class="kw">false</span><span class="fu">,</span><span class="dt">&quot;backSecond&quot;</span><span class="fu">:</span><span class="dv">-1</span><span class="fu">,</span>
<span class="dt">&quot;answers&quot;</span><span class="fu">:</span><span class="ot">[</span><span class="fu">{</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="dv">1045</span><span class="fu">,</span><span class="dt">&quot;content&quot;</span><span class="fu">:</span><span class="st">&quot;A、答案A&quot;</span><span class="fu">,</span><span class="dt">&quot;right&quot;</span><span class="fu">:</span><span class="kw">false</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="dv">1046</span><span class="fu">,</span><span class="dt">&quot;content&quot;</span><span class="fu">:</span><span class="st">&quot;B、答案B&quot;</span><span class="fu">,</span><span class="dt">&quot;right&quot;</span><span class="fu">:</span><span class="kw">true</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="dv">1047</span><span class="fu">,</span><span class="dt">&quot;content&quot;</span><span class="fu">:</span><span class="st">&quot;C、答案C&quot;</span><span class="fu">,</span><span class="dt">&quot;right&quot;</span><span class="fu">:</span><span class="kw">false</span><span class="fu">}</span><span class="ot">,</span><span class="fu">{</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="dv">1048</span><span class="fu">,</span><span class="dt">&quot;content&quot;</span><span class="fu">:</span><span class="st">&quot;D、答案D&quot;</span><span class="fu">,</span><span class="dt">&quot;right&quot;</span><span class="fu">:</span><span class="kw">false</span><span class="fu">}</span><span class="ot">]</span><span class="fu">}</span></code></pre></div>
<h3 id="视频上传">2.2 视频上传</h3>
<p>SDK视频上传由Uploader类实现，Uploader通过HTTP协议与服务端进行通信，上传视频信息和视频文件。同时，SDK提供了上传回调接口UploadListener来监听视频上传流程，如果需要在应用中展示上传状态、上传进度等信息，可根据需要进行设置。</p>
<h5 id="uploader使用示例">2.2.1 Uploader使用示例</h5>
<p>使用Uploader上传前，请先了解Uploader的工作流程：</p>
<ol style="list-style-type: decimal">
<li>创建Uploader实例，初始化视频信息，此时Uploader进入等待状态（<strong>WAIT</strong>）。</li>
<li>当需要开始上传时，调用start()方法开始上传，此时Uploader进入上传状态（<strong>UPLOAD</strong>）。</li>
<li>当需要暂停上传时，调用pause()方法。另外，在上传过程中可能出现网络异常问题，当出现此问题时，Uploader默认会暂停当前上传操作，进入暂停状态（<strong>PAUSE</strong>）。</li>
<li>当需要恢复上传时，调用resume()方法，若无网络异常等问题，此时Uploader会重新上传视频文件。</li>
<li>当需要取消上作时，调用cancel()方法，此时Uploader会进入等待状态（<strong>WAIT</strong>）。</li>
</ol>
<p>创建Uploader实例需提供<strong>VideoInfo</strong>（视频信息）和 API KEY，使用示例如下：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">VideoInfo videoInfo = <span class="kw">new</span> <span class="fu">VideoInfo</span>();
videoInfo.<span class="fu">setTitle</span>(<span class="st">&quot;title&quot;</span>);
videoInfo.<span class="fu">setTags</span>(<span class="st">&quot;tag&quot;</span>);
videoInfo.<span class="fu">setDescription</span>(<span class="st">&quot;description&quot;</span>); 
<span class="co">// 设置视频文件地址</span>
videoInfo.<span class="fu">setFilePath</span>(<span class="st">&quot;filePath&quot;</span>);
<span class="co">// 设置账号信息</span>
videoInfo.<span class="fu">setUserId</span>(<span class="st">&quot;USERID&quot;</span>);
<span class="co">// 设置回调信息</span>
videoInfo.<span class="fu">setNotifyUrl</span>(“NOTIFY_URL<span class="st">&quot;);</span>
Uploader uploader = <span class="kw">new</span> <span class="fu">Uploader</span>(videoInfo,<span class="st">&quot;API_KEY&quot;</span>);
<span class="co">// 开始上传</span>
uploader.<span class="fu">start</span>();</code></pre></div>
<p><strong>VideoInfo</strong>是用来记录上传过程与视频相关的信息，具体介绍请参考sdk_doc，在初始化视频信息时，服务端需根据视频的标题、标签、描述等来创建视频，所以在使用VideoInfo创建Uploader实例时，请确保视频信息非空。</p>
<p><strong>v2.3.4新增：</strong>新增disconnectRequest()方法，可以立刻停止当前url请求，该方法需配合pause()和cancel()方法来使用。</p>
<h4 id="设置上传回调">2.2.2 设置上传回调</h4>
<p>Uploader在执行上传操作时，默认会检查是否设置了UploadListener。若已设置UploadListener，Uploader会回调UploadListener已实现的方法；若未设置，则不回调任何信息。UploadListener具体使用方法如下：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">UploadListener uploadListener = <span class="kw">new</span> <span class="fu">UploadListener</span>(){
  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleProcess</span>(<span class="dt">long</span> range, <span class="dt">long</span> size, <span class="bu">String</span> videoId) {
    <span class="co">// TODO 处理上传进度</span>
  }
  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleException</span>(DreamwinException exception, <span class="dt">int</span> status) {
    <span class="co">// TODO 处理上传过程中出现的异常</span>
  }
  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleStatus</span>(VideoInfo videoInfo, <span class="dt">int</span> status) {
    <span class="co">// TODO 处理上传回调的视频信息及上传状态，status=100(等待上传)、200(正在上传)、300(暂停上传)、400(上传完成)、500(上传失败)</span>
  }
  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleCancel</span>(<span class="bu">String</span> videoId) {
    <span class="co">// TODO 处理取消上传的后续操作    </span>
  }
  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onVideoInfoUpdate</span>(<span class="bu">VideoInfo</span> videoInfo) {
    <span class="co">// TODO 上传信息更新回调，可以在这里保存最新的videoInfo状态    </span>
  }
};
uploader.<span class="fu">setUploadListener</span>(uploadListenner);</code></pre></div>
<h3 id="视频下载">2.3 视频下载</h3>
<p>SDK视频下载由Downloader类实现的，Downloader通过HTTP协议与服务端进行通信，获取视频下载地址。同时，SDK提供了下载回调接口DownloadListener来监听视频下载流程，如果需要向用户展示下载状态、下载进度等信息，可根据需要进行设置。</p>
<h4 id="downloader使用示例">2.3.1 Downloader使用示例</h4>
<p>在使用Downloader前，请先了解Downloader的工作流程：</p>
<ol style="list-style-type: decimal">
<li>创建Downloader实例，初始化视频文件下载信息，此时Downloader进入等待状态（<strong>WAIT</strong>）。</li>
<li>当需要开始下载时，调用start()方法，此时Downloader进入下载状态（<strong>DOWNLOAD</strong>）。</li>
<li>当需要暂停下载时，调用pause()方法。另外，在下载过程中可能出现网络异常问题，当出现此问题时，Downloader默认会暂停下载操作，进入暂停状态（<strong>PAUSE</strong>）。</li>
<li>当需要恢复下载时，调用resume()方法。若无网络异常等问题，此时Downloader会重新下载视频文件。</li>
<li>当需要取消视频下载时，调用cancel()方法，此时Downloader会进入等待状态（<strong>WAIT</strong>）。</li>
</ol>
<p>创建Downloader实例需提供视频存储文件，视频ID，账户ID和API KEY。示例如下：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="bu">File</span> file = <span class="kw">new</span> <span class="bu">File</span>(<span class="st">&quot;/123456.MP4&quot;</span>);
<span class="bu">String</span> videoId =<span class="st">&quot;123456&quot;</span>;
Downloader downloader = <span class="kw">new</span> <span class="fu">Downloader</span>(file, videoId,<span class="st">&quot;USERID&quot;</span>,<span class="st">&quot;API_KEY&quot;</span>);
<span class="co">// 开始下载</span>
downloader.<span class="fu">start</span>();</code></pre></div>
<p>SDK视频下载需指定文件存储路径，所以在创建Downloader实例时，请提供正确的文件存储路径。</p>
<h4 id="设置下载回调">2.3.2 设置下载回调</h4>
<p>Downloader在执行下载操作时，默认会检查是否设置了DownloadListener。若已设置DownloadListener，Downloader会回调DownloadListener接口已实现的方法；若未设置，则不回调任何信息。DownloadListener使用方法如下：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">DownloadListener downloadListener = <span class="kw">new</span> <span class="fu">DownloadListener</span>(){
  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleProcess</span>(<span class="dt">long</span> start, <span class="dt">long</span> end, <span class="bu">String</span> videoId) {
    <span class="co">// TODO 处理下载进度</span>
  }

  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleException</span>(DreamwinException exception, <span class="dt">int</span> status) {
    <span class="co">// TODO 处理下载过程中发生的异常信息        </span>
  }

  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleStatus</span>(<span class="bu">String</span> videoId, <span class="dt">int</span> status) {
    <span class="co">// TODO 处理视频下载信息及相应状态</span>
  }

  <span class="at">@Override</span>
  <span class="kw">public</span> <span class="dt">void</span> <span class="fu">handleCancel</span>(<span class="bu">String</span> videoId) {
    <span class="co">// TODO 处理取消下载的后续操作</span>
  }
};

downloader.<span class="fu">setDownloadListener</span>(downloadListener);</code></pre></div>
<h4 id="选择清晰度下载">2.3.3 选择清晰度下载</h4>
<p>流程如下：</p>
<ol style="list-style-type: decimal">
<li>创建Downloader实例；</li>
<li>调用setOnProcessDefinitionListener()方式设置清晰度回调；</li>
<li>调用getDefinitionMap()方法获取清晰度；</li>
<li>根据获取的清晰度，调用setDownloadDefinition()方法设置想要的清晰度；</li>
<li>调用start()下载指定清晰度。</li>
</ol>
<p>获取清晰度时需实现OnProcessDefinitionListener接口的onProcessDefinition()方法，并调用Downloader的setOnProcessDefinitionListener()方法设置获取清晰度回调，获取清晰度的示例如下：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> DownloadDemo{
      <span class="kw">private</span> <span class="bu">HashMap</span>&lt;<span class="bu">Integer</span>, <span class="bu">String</span>&gt; dm;
      <span class="kw">private</span> Downlaoder downloader;

      <span class="kw">private</span> OnProcessDefinitionListener onProcessDefinitionListener = <span class="kw">new</span> <span class="fu">OnProcessDefinitionListener</span>(){
          <span class="at">@Override</span>
          <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onProcessDefinition</span>(<span class="bu">HashMap</span>&lt;<span class="bu">Integer</span>, <span class="bu">String</span>&gt; definitionMap) {
              <span class="kw">if</span>(definitionMap != <span class="kw">null</span>){
                  dm = definitionMap;
              } <span class="kw">else</span> {
                  Log.<span class="fu">e</span>(<span class="st">&quot;get definition error&quot;</span>, <span class="st">&quot;视频清晰度获取失败&quot;</span>);
              }
          }

          <span class="at">@Override</span>
          <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onProcessException</span>(DreamwinException exception) {
              Log.<span class="fu">i</span>(<span class="st">&quot;get definition exception&quot;</span>, exception.<span class="fu">getErrorCode</span>().<span class="fu">Value</span>());
          }

      };

      <span class="kw">private</span> <span class="fu">getDefinition</span>(){
          downloader.<span class="fu">setOnProcessDefinitionListener</span>(onProcessDefinitionListener);
          downloader.<span class="fu">getDefinitionMap</span>();
      }
      ……

  }</code></pre></div>
<h4 id="设置下载重试次数">2.3.4 设置下载重试次数</h4>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">//设置下载重试次数，默认为0，可设置区间[0, 100]</span>
<span class="fu">setReconnectLimit</span>(<span class="dt">int</span> reconnectLimit)</code></pre></div>
<h4 id="设置超时时间">2.3.5 设置超时时间</h4>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">//设置网络请求的超时时间,区间[5000-30000]，单位为ms，默认值为10000ms</span>
<span class="fu">setTimeOut</span>(<span class="dt">int</span> timeOut)</code></pre></div>
<p><br/></p>
<h3 id="音频支持">2.4 音频支持</h3>
<p>SDK音频播放由DWMediaPlayer类实现，DWMediaPlayer继承了Android的媒体播放器MediaPlayer类，并重载其prepare()和prepareAsync()方法。</p>
<h4 id="音频在线播放">2.4.1 音频在线播放</h4>
<p>目前播放器默认支持的为视频播放，想要进行音频播放，在prepareAsync()之前则需要如下设置：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">player.<span class="fu">setDefaultPlayMode</span>(MediaMode.<span class="fu">AUDIO</span>, onPlayModeListener);
player.<span class="fu">setAudioPlay</span>(<span class="kw">true</span>);
player.<span class="fu">prepareAsync</span>();</code></pre></div>
<p>如果默认设置的为支持音视频模式，那么从视频切换到音频的方法为如下：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">player.<span class="fu">reset</span>();
player.<span class="fu">setAudioPlay</span>(<span class="kw">true</span>)
player.<span class="fu">prepareAsync</span>();</code></pre></div>
<p>注：onPlayModeListener的回调返回该视频节点信息支持的播放模式。如果没有节点信息，onPlayModeListener的回调返回为null。</p>
<h4 id="音频本地播放">2.4.2 音频本地播放</h4>
<p>参考章节2.1.2</p>
<h4 id="音频下载">2.4.3 音频下载</h4>
<p>参考2.3。</p>
<ol style="list-style-type: decimal">
<li>下载前需要调用setDownloadMode(MediaMode downloadMode)来设置下载的模式</li>
<li>音频的后缀存储为.mp3或者.m4a</li>
</ol>
<h4 id="demo使用">2.4.4 demo使用</h4>
<ol style="list-style-type: decimal">
<li>音频相关请参考普通demo</li>
<li>AccountInfoActivity.java里面增加了默认播放、下载的配置</li>
<li>下载部分数据表更新，老用户请卸载老demo在安装</li>
</ol>
<h2 id="如何更好的使用sdk-demo">3. 如何更好的使用SDK Demo？</h2>
<p><br/></p>
<p>SDK Demo是使用SDK对接CC视频云服务的示例源码，目前支持Android4.0及以上版本。Demo的设计旨在展示SDK各项功能的使用方法，如果希望应用获得更好的使用体验，可根据需求自行更改。</p>
<h3 id="准备">3.1 准备</h3>
<p>在编译安装Demo前，请按照以下操作进行配置：</p>
<ol style="list-style-type: decimal">
<li>设置帐户信息，在ConfigUtil类中配置USERID（帐户ID）和API KEY。</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">final</span> <span class="dt">static</span> <span class="bu">String</span> API_KEY = <span class="st">&quot;API KEY&quot;</span>;
<span class="kw">public</span> <span class="dt">final</span> <span class="dt">static</span> <span class="bu">String</span> USERID = <span class="st">&quot;123456&quot;</span>;</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>添加播放列表，在PlayFragment类中配置playVideoIds（可播放的视频ID）。</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">//TODO 待播放视频ID列表，可根据需求自定义</span>
<span class="kw">private</span> <span class="bu">String</span>[] playVideoIds = <span class="kw">new</span> <span class="bu">String</span>[] {
    <span class="st">&quot;123456&quot;</span>,
    <span class="st">&quot;234567&quot;</span>,
    <span class="st">&quot;345678&quot;</span>, 
    <span class="st">&quot;111111&quot;</span>};</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>添加下载列表，在DownloadFragment类中配置downloadVideoIds（可下载的视频ID）。</li>
</ol>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">//TODO 待下载视频ID，可根据需求自定义</span>
<span class="kw">private</span> <span class="bu">String</span>[] downloadVideoIds = <span class="kw">new</span> <span class="bu">String</span>[] {
    <span class="st">&quot;123456&quot;</span>,
    <span class="st">&quot;234567&quot;</span>,
    <span class="st">&quot;345678&quot;</span>, 
    <span class="st">&quot;111111&quot;</span>};</code></pre></div>
<p><br /></p>
<h3 id="功能模块简介">3.2 功能模块简介</h3>
<p>Demo包含播放、上传和下载三个功能模块：</p>
<ul>
<li><p>播放模块，展示了在线播放，屏幕缩放，清晰度切换，字幕等功能，具体实现请参考PlayFragment及MediaPlayActivity类。</p></li>
<li><p>上传模块，展示了视频上传的处理流程，及如何使用SDK进行后台上传，具体实现请参考UploadFragment及UploadService类。</p></li>
<li><p>下载模块，展示了视频下载的处理流程，及如何使用SDK进行后台下载，具体实现请参考DownloadFragment及DownloadService类。</p></li>
</ul>
<p><br/></p>
<h2 id="功能调试和问题反馈">4. 功能调试和问题反馈</h2>
<p><br/></p>
<h3 id="辅助调试工具">4.1 辅助调试工具</h3>
<p>SDK提供HTTP通信日志调试功能。在使用SDK进行播放、上传、下载过程中，如果遇到与网络通信相关的问题，可通过设置HTTP日志的级别获取通信信息。使用示例如下：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// 设置HTTP通信日志级别</span>
HttpUtil.<span class="fu">LOG_LEVEL</span> = HttpLogLevel.<span class="fu">DETAIL</span>;</code></pre></div>
<p>默认日志级别为GENERAL（记录HTTP通信发⽣生时间、响应状态码）。</p>
<h3 id="faq">4.2 FAQ</h3>
<h5 id="q无法播放视频">Q：无法播放视频</h5>
<pre><code>1.检查已配置的帐户是否开通移动端播放权限
2. 根据HTTP通信日志，排查网络问题
3. 检查视频状态是否正常</code></pre>
<h5 id="q上传视频出现异常">Q：上传视频出现异常</h5>
<pre><code>1. 检查已配置的帐户是否开通了客户端上传权限
2. 根据HTTP通信日志，排查网络问题</code></pre>
<h5 id="q下载视频出现异常">Q：下载视频出现异常</h5>
<pre><code>1. 检查已配置的帐户是否开通了移动端权限
2. 根据HTTP通信日志，排查网络问题
3. 检查视频状态是否正常</code></pre>
<h2 id="附录">附录</h2>
<h3 id="倍速功能">倍速功能</h3>
<p>倍速功能使用第三方库IjkMediaPlayer v0.8.4来实现。倍速播放功能需要使用DWIjkMediaPlayer类，该类继承自第三方库IjkMediaPlayer的IjkMediaPlayer类，该类的使用方法和DWMediaPlayer一样。</p>
<p>IjkMeidaPlayer的github地址如下：（请参考链接：<a href="https://github.com/Bilibili/ijkplayer" class="uri">https://github.com/Bilibili/ijkplayer</a>）</p>
<p>设置倍速方法如下：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">player.<span class="fu">setSpeed</span>();</code></pre></div>
<p>ijkspeed文件夹为ijk所需要的so文件和jar，请放到自己的工程目录使用。</p>
<h3 id="demo使用-1">DEMO使用</h3>
<p>具体查看SpeedIjkMediaPlayActivity类，需要更改PlayFragment.java的onItemClickListener方法，启动intent为倍速intent。</p>
<p>更多信息请参考CC视频<a href="http://doc.bokecc.com">开发者支持</a>网站，如果在使用SDK过程中遇到其他问题请联系CC客服进行反馈</p>
</body>
</html>
